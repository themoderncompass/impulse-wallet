<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Impulse Wallet</title>
  <link rel="stylesheet" href="styles.css?v=4">
  <link rel="icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512.png">
</head>
<body>
  <main class="container">

<header class="header">
  <h1>Impulse Wallet</h1>
  
  <!-- Header Actions -->
  <div class="header-actions">
    <button id="instructions-open"
            class="header-btn instructions-btn"
            type="button"
            aria-haspopup="dialog"
            aria-controls="instructions-modal"
            aria-label="View instructions">
      Instructions
    </button>

    <button id="focus-open"
            class="header-btn focus-btn hidden"
            type="button"
            aria-haspopup="dialog"
            aria-controls="focus-modal"
            aria-label="Open weekly focus">
      Weekly Focus
    </button>

    <button id="room-manage-open"
            class="header-btn settings-btn hidden"
            type="button"
            aria-haspopup="dialog"
            aria-controls="room-manage-modal"
            aria-label="Manage room settings">
      Room Settings
    </button>
  </div>
</header>

<!-- Onboarding Overlay -->
<div class="onboarding-overlay" id="onboardingOverlay">
  <div class="onboarding-card">
    <h2 class="onboarding-title" id="onboardingTitle">Welcome to Impulse Wallet!</h2>
    <p class="onboarding-text" id="onboardingText">
      Your personal accountability partner! Track your actions and stay committed to the goals that matter to you.
    </p>
    <button class="onboarding-button" id="onboardingButton" onclick="nextOnboardingStep()">
      Let's Start!
    </button>
    <button class="onboarding-skip" onclick="skipOnboarding()">Skip Tutorial</button>
  </div>
</div>

<!-- Tooltip -->
<div class="tooltip" id="tooltip"></div>

<!-- Instructions modal -->
<div id="instructions-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="instructions-title" hidden>
  <div class="modal-content" role="document" tabindex="-1">
    <button id="instructions-close" class="modal-close" type="button" aria-label="Close instructions">×</button>
    <h2 id="instructions-title">Instructions</h2>
    <div class="modal-body">
<section class="iw-instructions">
  <h2>Impulse Wallet</h2>
  <p class="lead">
    Impulse Wallet helps you track positive actions and resist negative impulses. Build momentum by logging when you follow through and being honest when you don't.
  </p>

  <h3>How it Works</h3>
  <ol class="steps">
    <li><strong>Pick Focus Areas:</strong> Choose 2–3 areas (fitness, work, relationships, mindfulness). Most actions should connect here, but they do not have to.</li>
    <li><strong>Make Deposits:</strong> Log when you act on a positive impulse (exercise, finish a task) or resist a negative one (skip scrolling, avoid procrastination).</li>
    <li><strong>Log Withdrawals:</strong> Record when you give in to an impulse you meant to resist. Withdrawals reset your streak and show where to focus.</li>
    <li><strong>Track Streaks:</strong> Consistency matters. More deposits than withdrawals builds momentum.</li>
    <li><strong>Start Fresh Each Week:</strong> Your wallet resets every Monday so you can refocus and choose new areas if you want.</li>
  </ol>

  <h3>The Purpose</h3>
  <p>
    This is about building self-trust through accountability. By tracking your follow-through,
    you develop the discipline to keep the promises you make to yourself.
  </p>
</section>

<style>
  .iw-instructions { max-width: 48rem; margin: 0 auto; line-height: 1.6; }
  .iw-instructions .lead { margin: 0 0 1rem 0; }
  .iw-instructions h2 { font-size: 1.25rem; margin: 0 0 .5rem 0; }
  .iw-instructions h3 { font-size: 1rem; margin: 1rem 0 .5rem 0; }
  .iw-instructions .steps { padding-left: 1.25rem; margin: 0; }
  .iw-instructions .steps li { margin: .5rem 0; }
  .iw-instructions .steps li strong { display: inline-block; min-width: 15ch; }
</style>

    </div>
  </div>
</div>

<!-- Weekly Focus modal -->
<div id="focus-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="focus-title" hidden>
  <div class="modal-content" role="document" tabindex="-1">
    <button id="focus-close" class="modal-close" type="button" aria-label="Close weekly focus">×</button>
    <h2 id="focus-title">Choose your 2–3 focus areas</h2>
    <p class="muted">These lock for the week and reset Monday at 12:01 AM.</p>

    <form id="focus-form">
   <fieldset class="focus-grid">
  <label><input type="checkbox" name="focusArea" value="Eat Healthy"> Eat Healthy</label>
  <label><input type="checkbox" name="focusArea" value="Exercise"> Exercise</label>
  <label><input type="checkbox" name="focusArea" value="Scrolling"> Scrolling</label>
  <label><input type="checkbox" name="focusArea" value="Snacking"> Snacking</label>
  <label><input type="checkbox" name="focusArea" value="Spending"> Spending</label>
  <label><input type="checkbox" name="focusArea" value="Booze"> Booze</label>
  <label><input type="checkbox" name="focusArea" value="Procrastination"> Procrastination</label>
  <label><input type="checkbox" name="focusArea" value="Gratitude"> Gratitude</label>
</fieldset>

      </fieldset>

      <!-- Optional custom area -->
      <div class="focus-custom">
        <input id="focus-custom-input" type="text" placeholder="Add a custom area">
        <button type="button" id="focus-add-custom">Add</button>
      </div>

      <div class="focus-actions">
        <span id="focus-error" class="error" aria-live="polite"></span>
        <button type="submit" class="primary">Save</button>
      </div>
    </form>
  </div>
</div>

    <section class="card">
      <div class="join">
        <div>
          <label>Room code</label>
          <input id="room" placeholder="ABCDE" />
        </div>
        <div>
          <label>Display name</label>
          <input id="name" placeholder="Your name" />
        </div>
        <div>
          <label>Invite code <span class="optional">(if room is locked)</span></label>
          <input id="invite-code" placeholder="8-character code" maxlength="8" />
        </div>
        <div class="actions">
<button id="create" class="primary" type="button">Create room</button>
<button id="join"   class="secondary" type="button">Join</button>

        </div>
      </div>

      <div id="play" class="hidden">
        <!-- Wallet Header -->
        <div class="wallet-header">
          <div class="wallet-meta">
            <span id="week"></span>
          </div>
          
          <div class="wallet-balance-row">
            <!-- Left side: Wallet + Balance grouped together -->
            <div class="wallet-balance-group">
              <div class="wallet-container">
                <div class="wallet-image" id="wallet-display"></div>
              </div>
              <div class="balance-display">
                <div class="balance-amount" id="current-balance">$0</div>
                <div class="balance-label">Current Balance</div>
              </div>
            </div>

            <!-- Right side: Mobile focus areas -->
            <div class="mobile-focus-areas" id="mobile-focus-areas" style="display: none;">
              <div class="section-title">Focus Areas</div>
              <!-- Focus Area Selection Prompt (shown when no areas selected) -->
              <div class="focus-selection-prompt" id="focus-selection-prompt-mobile" onclick="openFocusModal()">
                <div class="focus-prompt-title">Choose Your Focus</div>
                <div class="focus-prompt-subtitle">
                  Choose 3 focus areas for this week.<br>
                  Click here to get started!
                </div>
              </div>
              <!-- Selected Focus Areas (shown when areas are chosen) -->
              <div id="focus-chips-mobile" class="focus-chips" aria-label="Weekly focus areas"></div>
            </div>
          </div>
        </div>

        <!-- Main Content Grid -->
        <div class="main-content">
          <!-- Focus Areas (Left) -->
          <div class="focus-areas">
            <div class="section-title">Focus Areas</div>
            
            <!-- Focus Area Selection Prompt (shown when no areas selected) -->
            <div class="focus-selection-prompt" id="focus-selection-prompt" onclick="openFocusModal()">
              <div class="focus-prompt-title">Choose Your Focus</div>
              <div class="focus-prompt-subtitle">
                Choose 3 focus areas for this week.<br>
                Click here to get started!
              </div>
            </div>
            
            <!-- Selected Focus Areas (shown when areas are chosen) -->
            <div id="focus-chips" class="focus-chips hidden" aria-label="Weekly focus areas"></div>
          </div>

          <!-- Actions (Right) -->
          <div class="balance-actions">
            <div class="section-title">Actions</div>
            <button id="plus" class="action-button deposit-btn">
              Deposit +$1
            </button>
            <button id="minus" class="action-button withdraw-btn">
              Withdrawal −$1
            </button>
            <input id="impulse" placeholder="Action note" />
          </div>
        </div>

        <div id="banner" class="hidden banner"></div>

        <!-- Leaderboard -->
        <div class="leaderboard">
          <div class="leaderboard-title">Leaderboard</div>
          <table id="board">
            <thead><tr><th>Player</th><th>Progress</th><th>Streak</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons-row">
          <button id="undo" class="outline-button grey-outline">Undo last (15 min)</button>
          <button id="leave-room" class="outline-button red-outline hidden">Leave Room</button>
        </div>

        <!-- My History Button -->
        <button id="history-open" class="history-button" type="button" aria-haspopup="dialog" aria-controls="history-modal">
          My History
        </button>
      </div>
    </section>
      <!-- Footer -->
  <footer class="site-footer">
    <nav class="legal-links" aria-label="Legal">
      <a href="https://themoderncompass.io" target="_blank" rel="noopener noreferrer" class="link-like">
        Modern Compass
      </a>
      <span class="sep" aria-hidden="true">|</span>
      <button id="open-privacy" class="link-like" type="button" aria-haspopup="dialog" aria-controls="privacy-modal">
        Privacy Policy
      </button>
      <span class="sep" aria-hidden="true">|</span>
      <button id="open-terms" class="link-like" type="button" aria-haspopup="dialog" aria-controls="terms-modal">
        Terms & Conditions
      </button>
      <span class="sep" aria-hidden="true">|</span>
      <!-- Contact button -->
      <button id="contact-btn" class="link-like" type="button" aria-haspopup="dialog" aria-controls="contact-modal">
        Contact
      </button>
    </nav>
    <small>© 2025 Modern Compass. All rights reserved</small>
  </footer>

  <!-- Privacy Policy modal -->
  <div id="privacy-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="privacy-title" hidden>
    <div class="modal-content" role="document" tabindex="-1">
      <button id="privacy-close" class="modal-close" type="button" aria-label="Close privacy policy">×</button>
      <h2 id="privacy-title">Privacy Policy</h2>
      <div class="modal-body policy-body">
        <p><strong>Last updated:</strong> September 2, 2025</p>
        <p>Impulse Wallet is a product offered by <strong>Modern Compass, a brand operated by Josh Imholte</strong> (“we,” “us,” “our”). We respect your privacy and are committed to protecting your information. This Privacy Policy explains what we collect, how we use it, and your choices.</p>

        <h3>1. What we collect</h3>
        <ul>
          <li><strong>Account or contact info:</strong> If you join the beta, we may collect your email to grant access and share updates.</li>
          <li><strong>App data you provide:</strong> Focus areas, weekly actions, and simple settings.</li>
          <li><strong>Local storage on your device:</strong> We may use localStorage or cookies to remember session state and preferences.</li>
          <li><strong>Basic analytics (optional):</strong> We may use lightweight analytics to understand usage such as page views and feature adoption. We do not sell personal data.</li>
        </ul>

        <h3>2. How we use data</h3>
        <ul>
          <li>To operate and improve Impulse Wallet.</li>
          <li>To communicate about the beta.</li>
          <li>To analyze anonymized or aggregated usage trends that guide product decisions and content.</li>
        </ul>

        <h3>3. Data sharing</h3>
        <p>We do not sell your personal information. We may share limited data with service providers who help us run the product such as hosting or analytics. These providers are bound by confidentiality and only use data to perform services for us. We may disclose information if required by law or to protect our rights, users, or the service.</p>

        <h3>4. Data retention</h3>
        <ul>
          <li><strong>App data:</strong> Kept as long as needed to provide the service or until you request deletion.</li>
          <li><strong>Beta emails:</strong> Retained while the beta is active or until you opt out.</li>
          <li><strong>Local device storage:</strong> You can clear your browser or app storage at any time. Doing so may affect your experience.</li>
        </ul>

        <h3>5. Your choices</h3>
        <ul>
          <li><strong>Access, correction, or deletion:</strong> Email us to request a copy, correction, or deletion of your data.</li>
          <li><strong>Opt out of emails:</strong> Use unsubscribe links where available or email us.</li>
        </ul>

        <h3>6. Children’s privacy</h3>
        <p>Impulse Wallet is not directed to children under 13 or the minimum age in your jurisdiction. Do not use the service if you are under that age.</p>

        <h3>7. Security</h3>
        <p>We use reasonable safeguards appropriate for an MVP or beta product. No method of transmission or storage is 100% secure.</p>

        <h3>8. International users</h3>
        <p>If you access the app outside the United States, you consent to processing in the United States where privacy laws may differ.</p>

        <h3>9. Changes to this policy</h3>
        <p>We may update this Privacy Policy. Material changes will be highlighted by updating the Last updated date and, where reasonable, via in-app notice.</p>

        <h3>10. Contact</h3>
        <p>Questions or requests: <em>replace with your support email</em><br>
        Business name: <strong>Modern Compass, a brand operated by Josh Imholte</strong></p>
      </div>
    </div>
  </div>

  <!-- Terms and Conditions modal -->
  <div id="terms-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="terms-title" hidden>
    <div class="modal-content" role="document" tabindex="-1">
      <button id="terms-close" class="modal-close" type="button" aria-label="Close terms and conditions">×</button>
      <h2 id="terms-title">Terms and Conditions</h2>
      <div class="modal-body policy-body">
        <p><strong>Last updated:</strong> September 2, 2025</p>
        <p>Impulse Wallet is a product offered by <strong>Modern Compass, a brand operated by Josh Imholte</strong>. These Terms and Conditions govern your access to and use of Impulse Wallet. By using the app, you agree to these Terms.</p>

        <h3>1. Beta nature</h3>
        <p>Impulse Wallet is in beta. Features may change, break, or be discontinued. We may suspend or terminate access at any time.</p>

        <h3>2. Eligibility</h3>
        <p>You must be at least 13 years old or the minimum age in your jurisdiction and able to form a binding contract. You are responsible for the activity on your account or device.</p>

        <h3>3. Acceptable use</h3>
        <p>Do not misuse the app including reverse engineering, attacking, scraping, or using it unlawfully. Do not upload or transmit harmful code. Use the app only as intended and in compliance with applicable laws.</p>

        <h3>4. Content and data</h3>
        <p>You retain rights to the content and data you provide. You grant us a non-exclusive, worldwide license to use, store, and process your content as needed to operate and improve the service including anonymized or aggregated analysis.</p>

        <h3>5. No financial, medical, or legal advice</h3>
        <p>Impulse Wallet is a self-improvement and habit tool. It does not provide financial, medical, mental-health, or legal advice. Decisions you make using the app are your responsibility.</p>

        <h3>6. Disclaimer of warranties</h3>
        <p>THE SERVICE IS PROVIDED “AS IS” AND “AS AVAILABLE.” TO THE FULLEST EXTENT PERMITTED BY LAW, WE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, AND NON-INFRINGEMENT. We do not guarantee error-free or uninterrupted operation.</p>

        <h3>7. Limitation of liability</h3>
        <p>TO THE FULLEST EXTENT PERMITTED BY LAW, WE INCLUDING ANY CONTRACTORS OR SERVICE PROVIDERS WE WORK WITH WILL NOT BE LIABLE FOR INDIRECT, INCIDENTAL, SPECIAL, CONSEQUENTIAL, EXEMPLARY, OR PUNITIVE DAMAGES, OR ANY LOSS OF PROFITS, REVENUE, DATA, OR GOODWILL. OUR TOTAL LIABILITY FOR ANY CLAIM WILL NOT EXCEED <strong>$100</strong> OR THE AMOUNT YOU PAID US IN THE 3 MONTHS BEFORE THE CLAIM WHICHEVER IS GREATER.</p>

        <h3>8. Termination</h3>
        <p>You may stop using the app at any time. We may suspend or terminate access if you violate these Terms or for operational reasons. Upon termination, sections intended to survive including disclaimers and limitations of liability will continue to apply.</p>

        <h3>9. Changes to Terms</h3>
        <p>We may update these Terms. Continued use after changes become effective constitutes acceptance.</p>

        <h3>10. Governing law</h3>
        <p>These Terms are governed by the laws of Texas, USA, without regard to conflicts of law. Venue and jurisdiction lie in the state and federal courts located in Bexar County, Texas unless prohibited by law.</p>

        <h3>11. Contact</h3>
        <p>Questions about these Terms: <em>replace with your support email</em><br>
        Business name: <strong>Modern Compass, a brand operated by Josh Imholte</strong></p>
      </div>
    </div>
  </div>

  <!-- Contact modal -->
  <div id="contact-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="contact-title" hidden>
    <div class="modal-content" role="document" tabindex="-1">
      <button id="contact-close" class="modal-close" type="button" aria-label="Close contact form">×</button>
      <h2 id="contact-title">Get in Touch</h2>
      <div class="modal-body">
        <p class="muted">Found a bug? Have feedback? We would love to hear from you.</p>

        <!-- Success State (hidden by default) -->
        <div id="success-state" class="banner" style="text-align: center; padding: 2rem 1rem;" hidden>
          <h3 style="margin-top: 0; color: #059669;">Message Sent!</h3>
          <p class="muted">Thanks for reaching out. We will get back to you soon.</p>
        </div>

        <!-- Contact Form -->
        <form id="contact-form">
          <!-- Web3Forms access key -->
          <input type="hidden" name="access_key" value="bd8675f4-e7c6-4213-8e7c-2d79cae0a3bf">

          <div style="margin-bottom: 1rem;">
            <label for="contact-name" style="display: block; font-size: .9rem; color: #555; margin-bottom: .25rem;">Name</label>
            <input type="text" id="contact-name" name="name" placeholder="Your name" required>
          </div>
          
          <div style="margin-bottom: 1rem;">
            <label for="contact-email" style="display: block; font-size: .9rem; color: #555; margin-bottom: .25rem;">Email</label>
            <input type="email" id="contact-email" name="email" placeholder="your@email.com" required>
          </div>
          
          <div style="margin-bottom: 1rem;">
            <label for="contact-category" style="display: block; font-size: .9rem; color: #555; margin-bottom: .25rem;">Category</label>
            <select id="contact-category" name="category" style="width: 100%; padding: .65rem .75rem; border: 1px solid #d9dbe1; border-radius: 10px; background: #fff;" required>
              <option value="">Select a category</option>
              <option value="app-issue">App Issue</option>
              <option value="feature-request">Feature Request</option>
            </select>
          </div>
          
          <div style="margin-bottom: 1rem;">
            <label for="contact-message" style="display: block; font-size: .9rem; color: #555; margin-bottom: .25rem;">Message</label>
            <textarea id="contact-message" name="message" placeholder="What is on your mind?" required 
              style="width: 100%; padding: .65rem .75rem; border: 1px solid #d9dbe1; border-radius: 10px; background: #fff; min-height: 120px; resize: vertical; font-family: inherit;"></textarea>
          </div>
          
          <div class="actions">
            <button type="button" id="cancel-btn" class="secondary">Cancel</button>
            <button type="button" id="submit-btn" class="primary">Send Message</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  </main>

<script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
<script src="app.js?v=2"></script>

<!-- History Modal -->
<div id="history-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="history-title" hidden>
  <div class="modal-content modal-content-wide" role="document" tabindex="-1">
    <button id="history-close" class="modal-close" type="button" aria-label="Close history">×</button>
    <h2 id="history-title">My History</h2>
    <div class="modal-body">
      <div class="history-controls">
        <div class="history-filters">
          <label for="history-months">Show last:</label>
          <select id="history-months">
            <option value="1">1 month</option>
            <option value="3">3 months</option>
            <option value="6">6 months</option>
            <option value="12" selected>12 months</option>
            <option value="24">2 years</option>
            <option value="all">All time</option>
          </select>
        </div>
        <div class="history-actions">
          <button id="history-csv" class="secondary" type="button">
            📥 Export CSV
          </button>
          <button id="history-refresh" class="secondary" type="button">
            🔄 Refresh
          </button>
        </div>
      </div>
      
      <!-- Newsletter signup section -->
      <div class="newsletter-section">
        <div class="newsletter-content">
          <div class="newsletter-text">
            <h3>📈 Level up your focus game</h3>
            <p>Get monthly productivity insights and focus strategies delivered to your inbox.</p>
          </div>
          <div class="newsletter-action">
            <a href="https://themoderncompass.io/newsletter/" target="_blank" rel="noopener noreferrer" class="newsletter-btn">
              Get Tips Monthly
            </a>
            <button id="newsletter-dismiss" class="newsletter-dismiss" aria-label="Dismiss newsletter signup">×</button>
          </div>
        </div>
      </div>
      
      <div class="history-stats">
        <div class="stat-card">
          <div class="stat-value" id="total-entries">—</div>
          <div class="stat-label">Total Entries</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="history-balance">—</div>
          <div class="stat-label">Current Balance</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="best-streak">—</div>
          <div class="stat-label">Best Streak</div>
        </div>
      </div>
      
      <div class="history-table-container">
        <table id="history-table">
          <thead>
            <tr>
              <th>Date & Time</th>
              <th>Type</th>
              <th>Amount</th>
              <th>Note</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="history-tbody">
            <!-- Populated by JavaScript -->
          </tbody>
        </table>
        <div id="history-empty" class="empty-state" hidden>
          <div class="empty-icon">📊</div>
          <h3>No history yet</h3>
          <p>Your entries will appear here once you start tracking.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Room Management Modal -->
<div id="room-manage-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="room-manage-title" hidden>
  <div class="modal-content" role="document" tabindex="-1">
    <button id="room-manage-close" class="modal-close" type="button" aria-label="Close room settings">×</button>
    <h2 id="room-manage-title">Room Settings</h2>
    <div class="modal-body">
      <div class="room-info">
        <h3>Room: <span id="room-code-display">—</span></h3>
        <p class="muted">As the room creator, you can manage these settings.</p>
      </div>
      
      <div class="invite-code-section">
        <h3>🔗 Invite Code</h3>
        <div class="invite-code-display">
          <input type="text" id="invite-code-value" readonly value="—" class="invite-code-input">
          <button id="copy-invite-code" class="secondary" title="Copy invite code">📋 Copy</button>
        </div>
        <p class="muted">Share this code with others to let them join when the room is invite-only.</p>
      </div>
      
      <div class="room-settings">
        <div class="setting-group">
          <label class="setting-label">
            <input type="checkbox" id="room-invite-only"> 
            <span>👥 Invite Only</span>
          </label>
          <p class="setting-desc">When enabled, new members need the invite code above to join this room. Room creator can always join without a code.</p>
        </div>
        
        <div class="setting-group">
          <label class="setting-label">
            <span>👤 Member Limit</span>
          </label>
          <select id="room-max-members">
            <option value="10">10 members</option>
            <option value="25">25 members</option>
            <option value="50" selected>50 members</option>
            <option value="100">100 members</option>
          </select>
          <p class="setting-desc">Maximum number of room members</p>
        </div>
      </div>
      
      <div class="room-members">
        <h3>Members (<span id="member-count">0</span>)</h3>
        <div id="members-list" class="members-list">
          <!-- Members populated by JavaScript -->
        </div>
      </div>
      
      <div class="room-actions">
        <button id="save-room-settings" class="primary">Save Changes</button>
        <button id="cancel-room-settings" class="secondary">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Enhanced Notification System -->
<div id="notification-container" class="notification-container">
  <!-- Notifications will be inserted here dynamically -->
</div>

<!-- Celebration System -->
<div id="celebration-overlay" class="celebration-overlay hidden">
  <div class="celebration-content">
    <div class="celebration-icon">🎉</div>
    <h2 class="celebration-title">Congratulations!</h2>
    <p class="celebration-message">You've reached $20 this week!</p>
    <button class="celebration-close" onclick="closeCelebration()">Continue</button>
  </div>
</div>

<div id="milestone-warning" class="celebration-overlay warning hidden">
  <div class="celebration-content">
    <div class="celebration-icon">⚠️</div>
    <h2 class="celebration-title">Heads Up!</h2>
    <p class="celebration-message">You've hit -$20 this week. Time to refocus!</p>
    <button class="celebration-close" onclick="closeWarning()">I Got This</button>
  </div>
</div>

<!-- Contact modal script (runs after app.js, fully defensive) -->
<script>
(function() {
  try {
    const contactBtn = document.getElementById('contact-btn');
    const contactModal = document.getElementById('contact-modal');
    if (!contactBtn || !contactModal) return; // do nothing if markup not present

    const closeBtn = document.getElementById('contact-close');
    const cancelBtn = document.getElementById('cancel-btn');
    const submitBtn = document.getElementById('submit-btn');
    const contactForm = document.getElementById('contact-form');
    const successState = document.getElementById('success-state');
    const modalContent = contactModal.querySelector('.modal-content');

    const nameInput = document.getElementById('contact-name');
    const emailInput = document.getElementById('contact-email');
    const categoryInput = document.getElementById('contact-category');
    const messageInput = document.getElementById('contact-message');

    let isSubmitting = false;

    function updateSubmitButton() {
      if (!submitBtn) return;
      submitBtn.disabled = !!isSubmitting;
      submitBtn.textContent = isSubmitting ? 'Sending...' : 'Send Message';
    }

    function resetForm() {
      if (contactForm) contactForm.reset();
      if (contactForm) contactForm.hidden = false;
      if (successState) successState.hidden = true;
      isSubmitting = false;
      updateSubmitButton();
    }

    function openModal() {
      contactModal.hidden = false;
      if (modalContent) modalContent.focus();
      if (nameInput) nameInput.focus();
    }

    function closeModal() {
      contactModal.hidden = true;
      resetForm();
    }

    contactBtn.addEventListener('click', openModal);
    if (closeBtn) closeBtn.addEventListener('click', closeModal);
    if (cancelBtn) cancelBtn.addEventListener('click', closeModal);

    // Close on outside click
    contactModal.addEventListener('click', function(e) {
      if (e.target === contactModal) closeModal();
    });

    // Close on Escape only while open
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && !contactModal.hidden) closeModal();
    });

    // Submit handler → Web3Forms
    if (submitBtn) submitBtn.addEventListener('click', async function () {
      if (isSubmitting) return;

      // Basic validation
      if (!nameInput?.value || !emailInput?.value || !categoryInput?.value || !messageInput?.value) {
        alert('Please fill in all fields.');
        return;
      }

      isSubmitting = true;
      updateSubmitButton();

      try {
        const formData = new FormData(contactForm);

        const resp = await fetch('https://api.web3forms.com/submit', {
          method: 'POST',
          body: formData
        });

        const result = await resp.json();

        if (resp.ok && result.success) {
          // Show success state
          if (contactForm) contactForm.hidden = true;
          if (successState) successState.hidden = false;

          // Auto close after 3 seconds
          setTimeout(() => { closeModal(); }, 3000);
        } else {
          console.error('Web3Forms error:', result);
          alert('Sorry, there was an error sending your message. Please try again.');
        }
      } catch (err) {
        console.error('Network error:', err);
        alert('Sorry, there was an error sending your message. Please try again.');
      }

      isSubmitting = false;
      updateSubmitButton();
    });
  } catch (e) {
    console.error('Contact modal init error:', e);
  }
})();
</script>

</body>
</html>
